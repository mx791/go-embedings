# go-embeddings

# 1 : The Spotify Playlist dataset
The dataset is available with its description at this adress: https://www.aicrowd.com/challenges/spotify-million-playlist-dataset-challenge

It is made of several playlists files, with for each playlist a short summary and it's owner name. The important part is the list of tracks included in the playlist.

# 2 : Data preprocessing
We use Node.JS to extract tracks and create a dataset.
2 scripts must be run : 
- extract-track.js : loads all tracks from playlists, and select the N most popular.
- create-playlist-array.js : uses the tracks list generated by the first script, and then transcribe all playlists in arrays of ids.

These scripts can be run using the following commands : 
```
node ./pre-processing/extract-track.js
node ./pre-processing/create-playlist-array.js
```

# 2 : Embedding creation with Go

The go folder contains some code to load a list of array of ids, and then train embeddings from this dataset.
To run this algorithm, we can use tyhe following :

```
go run .
```

Arguements can be provided :
- ITERS : the number of iteration for the algorithm
- LEARN_RATE : learning rate for weights updates ponderation
- LEARN_RATE_DECAY : the decay applyed to the learning rate after each iteration
- EMBEDDING_SIZE : the embedding vector's size for each track
- MAX_ID : if you want to limit to N tracks
- FILE_PATH : the input file path
- OUTPUT_PATH : The genrated embedding file path

An exemple using arguements :
```
go run . ITERS=15 FILE_PATH=../playlists_.json EMBEDDING_SIZE=48
```

```
seting ITERS to 15
seting FILE_PATH to ../playlists_.json
75416 lists
75403 lists after filtering
min id: 0 max id: 149999
iter 1 / 15 cosin_sim= 0.9652879245446296 euclidian_dst= 0.6825024166903452 learning_rate= 0.03
iter 2 / 15 cosin_sim= 0.9682028060585897 euclidian_dst= 0.5419254584251237 learning_rate= 0.009
iter 3 / 15 cosin_sim= 0.9612491022784547 euclidian_dst= 0.5006240361529779 learning_rate= 0.0026999999999999997
iter 4 / 15 cosin_sim= 0.9393608139108012 euclidian_dst= 0.46717414404588914 learning_rate= 0.0008099999999999998
iter 5 / 15 cosin_sim= 0.9283751799936244 euclidian_dst= 0.40733273845793416 learning_rate= 0.00024299999999999994
iter 6 / 15 cosin_sim= 0.9241186200721139 euclidian_dst= 0.37449499713562323 learning_rate= 7.289999999999998e-05
iter 7 / 15 cosin_sim= 0.9415363160243237 euclidian_dst= 0.36091763473127997 learning_rate= 2.1869999999999996e-05
iter 8 / 15 cosin_sim= 0.9253064299027434 euclidian_dst= 0.36374654595241096 learning_rate= 6.560999999999999e-06
iter 9 / 15 cosin_sim= 0.9255394781897667 euclidian_dst= 0.36318174374487655 learning_rate= 1.9682999999999994e-06
iter 10 / 15 cosin_sim= 0.931258459285228 euclidian_dst= 0.3573762339884645 learning_rate= 5.904899999999998e-07
iter 11 / 15 cosin_sim= 0.9267116359220557 euclidian_dst= 0.3625005641583099 learning_rate= 1.7714699999999994e-07
iter 12 / 15 cosin_sim= 0.9259189915220422 euclidian_dst= 0.3634076682537542 learning_rate= 5.314409999999998e-08
iter 13 / 15 cosin_sim= 0.9256210905222315 euclidian_dst= 0.3635427696366786 learning_rate= 1.5943229999999993e-08
iter 14 / 15 cosin_sim= 0.9252809133400441 euclidian_dst= 0.36362668870297793 learning_rate= 4.782968999999998e-09
iter 15 / 15 cosin_sim= 0.9311046423672327 euclidian_dst= 0.35810878996446044 learning_rate= 1.4348906999999994e-09
```

## A note about the metrics
Two metrics are displayed during the trainning :
- cosin_sim : For every track from every playlist, the cosin similarity is computed between its embedding, with the embedding of another track form the same playlist, and with the one of a track absent from the playlist. The metric displayed is the sum of all cosin similarity for tracks from different playlist, divided by the sum of all cosin similarity for tracks from the same playlist. If learning is doing well, embedding in the same playlist should be more similar, so the ratio should always stay between 1 and 0, the smallest is the best.
- euclidian_dist : For every track from every playlist, the euclidian distance is computed between its embedding, with the embedding of another track form the same playlist, and with the one of a track absent from the playlist. The metric displayed is the sum of all euclidian distances for tracks from dthe same playlist, divided by the sum of all euclidian distances for tracks from different playlists. If learning is doing well, embedding in the same playlist should have a smaller distance, so the ratio should always stay between 1 and 0, the smallest is the best.

In the example, we have a 0.35 euclidian ratio, which means tracks from the same playlist are -on average- three time closer than tracks from differents playlists.


# 2 : Result and exploitation with Python

Once embeddings have been trained, we want to use them to visualise similar tracks.
In a python notebook, we displayed the most similar tracks to "Thunderstruck de AC/DC", which outputs :

-  Back In Black - You Shook Me All Night Long
- L.A. Guns - I Love Rock And Roll
- White Lion - When The Children Cry
- Aerosmith - Water Song/Janie's Got A Gun
- Queensr√øche - Jet City Woman - 2003 Digital Remaster
- AC/DC - Stiff Upper Lip
- Michael Jackson - The Way You Make Me Feel - Single Version
- Saigon Kick - Love Is on the Way
- Meat Loaf - I'd Do Anything For Love (But I Won't Do That) - Longer Still But Not As Long As The Album Version
- AC/DC - The Jack


We can also use it to extend a playlist. Here we have the generated electro playlist with three tracks from "Daft-Punk" as an input :
- Daft Punk - Around The World
- Daft Punk - Harder Better Faster Stronger
- Daft Punk - Television Rules The Nation / Crescendolls
- Daft Punk - High Fidelity
- Girl Talk - Play Your Part (Pt. 1)
- Pendulum - The Tempest
- Daft Punk - One More Time
- Pharrell Williams - Marilyn Monroe
- Daft Punk - Around The World - Radio Edit
- Benny Benassi presents The Biz - Satisfaction - RL Grime Remix
- Daft Punk - Too Long / Steam Machine
- Daft Punk - Rinzler - Remixed by Kaskade
- Daft Punk - Da Funk
- Justice - Genesis
- C2C - Delta
- The Glitch Mob - Skytoucher
- The Glitch Mob - Animus Vox
- Pharrell Williams - Gust of Wind
- Girl Talk - What It's All About
- Dizzee Rascal - Dance Wiv Me
- Santigold - You'll Find A Way (Switch and Sinden Remix)
- The Glitch Mob - Fortune Days
- M.I.A. - XXXO
- Pretty Lights - Keep Em Bouncin
- Daft Punk - Rectifier
- Daft Punk - Aerodynamic (Daft Punk Remix)